// ?????????????????????????????????????????????????????????
// ??????????????????? Tour Controller ?????????????????????
// ?????????????????????????????????????????????????????????

// ??????????????????? File Modules ????????????????????????
// ?? Utilites
const AppError = require('../utils/appError')
const catchAsync = require('../utils/catchAsync')

// ?? Model
const Review = require('../models/reviewModel');

// ??????????????????? Node Modules ????????????????????????

// ??????????????????? Vendor Modules ??????????????????????

// ??????????????????? Middleware ??????????????????????????

// ??????????????????? route Handlers ??????????????????????

// ~~ Create Review
exports.createReview = catchAsync(async (req, res, next) => {
    
    // ## Create Review Model Instance
    const newReview = await Review.create(req.body);

    // ## Save Review to DB
    await newReview.save();

    // ^^ Response
    res.status(201).json({
        status: 'success',
        requestTime: req.requestTime,
        data: {
            review: newReview
        }
    })
})

// ~~ Get all reviews
exports.getAllReviews = catchAsync(async (req, res, next) => {

    // ## Query DB for reviews
    const reviews = await Review.find()

    // ^^ Response
    res.status(200).json({
        status: 'success',
        requestTime: req.requestTime,
        results: reviews.length,
        data: {
            reviews
        }
    })
})

// ~~ Get Review by ID
exports.getReview = catchAsync(async (req, res, next) => {

    // ~~ param id
    const id = req.param.id;

    // ## Query DB for Review
    const review = await Review.findById(id);

    // !! Error Handler
    if (!review) {
        return next(new AppError('No review found', 404))
    }

    // ^^ Response
    res.status(200).json({
        status: 'success',
        requestTime: req.requestTime,
        data: {
            review
        }
    })
})